# ImagePathifier - 완전한 프로젝트 명세서

## 프로젝트 개요
클립보드의 이미지를 파일 경로로 변환하는 크로스 플랫폼 데스크톱 애플리케이션. Claude CLI 및 기타 커맨드라인 도구와의 원활한 통합을 위해 특별히 설계됨.

## 핵심 기능

### 주요 목적
사용자가 클립보드에 이미지를 복사했을 때 (스크린샷, 파일 복사, 애플리케이션에서 복사 등), 이 앱은:
1. 클립보드의 이미지를 감지
2. 순차적 이름으로 지정된 디렉토리에 저장
3. 클립보드 내용을 파일 경로로 자동 교체
4. 저장된 이미지의 시각적 피드백 제공

이는 많은 CLI 도구(Claude CLI 등)가 이미지 데이터를 직접 받을 수 없지만 파일 경로는 처리할 수 있는 문제를 해결합니다.

## 기술 아키텍처

### 기술 스택
- **언어**: Python 3.7+
- **GUI 프레임워크**: customtkinter (모던 tkinter 래퍼)
- **이미지 처리**: Pillow (PIL)
- **클립보드 관리**: pyperclip (텍스트), ImageGrab (이미지)
- **플랫폼 지원**: Windows, macOS, Linux

### 프로젝트 구조
```
ImagePathifier/
├── ImagePathifier.py          # 진입점
├── src/
│   ├── app.py                # 메인 애플리케이션 클래스
│   ├── config.py             # 설정 관리
│   ├── image_manager.py     # 이미지 파일 작업
│   ├── ui/
│   │   ├── main_window.py   # 메인 윈도우 UI
│   │   └── settings_window.py # 설정 다이얼로그
│   └── utils/
│       └── clipboard.py     # 클립보드 작업
├── saved_images/             # 기본 이미지 저장소
├── settings.json            # 사용자 설정
└── requirements.txt         # Python 의존성
```

## 상세 구현 요구사항

### 1. 메인 애플리케이션 (`src/app.py`)
```python
class ImagePathifierApp:
    """
    핵심 애플리케이션 오케스트레이터:
    - 모든 관리자 초기화 (config, image, clipboard)
    - GUI 윈도우 설정
    - 붙여넣기 이벤트 처리
    - 설정 관리
    """
```

주요 책임:
- `settings.json`에서 설정 초기화
- 메인 윈도우 생성 및 관리
- 클립보드 붙여넣기 이벤트 처리 (키보드 단축키와 버튼 클릭 모두)
- 클립보드 관리자와 이미지 관리자 간 조정
- 설정 변경 동적 적용

### 2. 설정 관리 (`src/config.py`)
```python
class ConfigManager:
    """
    영구 설정 관리:
    - save_directory: 이미지 저장 위치 (기본값: ./saved_images)
    - max_images: 보관할 최대 이미지 수 (기본값: 20)
    - theme: UI 테마 (system/light/dark)
    - thumbnail_size: 이미지 미리보기 표시 크기
    """
```

설정은 JSON 형식으로 저장되며, 첫 실행 시 기본값 사용.

### 3. 이미지 관리 (`src/image_manager.py`)
```python
class ImageManager:
    """
    파일 작업 처리:
    - 순차적 명명 (img_0001.png, img_0002.png 등)
    - 디렉토리 관리
    - 형식 변환과 함께 이미지 저장
    - 기존 이미지 추적
    - max_images 초과 시 정리
    """
```

중요: 기존 번호가 매겨진 파일을 올바르게 처리하고 다음 사용 가능한 번호를 찾아야 함.

### 4. 클립보드 작업 (`src/utils/clipboard.py`)
```python
class ClipboardManager:
    """
    플랫폼별 클립보드 처리:
    - 클립보드의 이미지 감지
    - 이미지 데이터 추출
    - 텍스트(파일 경로) 클립보드에 복사
    """
```

**중요한 macOS 고려사항**: macOS에서는 키보드 단축키가 `Control-V` 외에 `Command-V`도 사용해야 함. 앱은 둘 다 바인딩해야 함:
- Windows/Linux: `Control-V`, `Control-v`
- macOS: `Command-V`, `Command-v`, `Control-V`, `Control-v`

적절한 키 바인딩을 위해 플랫폼 감지 필요.

### 5. 메인 윈도우 UI (`src/ui/main_window.py`)

레이아웃 구조:
```
┌─────────────────────────────────────┐
│ Image Pathifier          [⚙ 설정]    │ <- 제목 바와 설정 버튼
├─────────────────────────────────────┤
│   [📋 클립보드에서 붙여넣기]           │ <- 중앙 정렬된 붙여넣기 버튼
│   단축키: Cmd+V 또는 Ctrl+V          │ <- 도움말 텍스트
│   상태: 준비됨                       │ <- 상태 메시지
├─────────────────────────────────────┤
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐   │
│ │     │ │     │ │     │ │     │   │ <- 썸네일 그리드
│ │ img │ │ img │ │ img │ │ img │   │    (6열)
│ │     │ │     │ │     │ │     │   │
│ └─────┘ └─────┘ └─────┘ └─────┘   │
│  0005    0004    0003    0002      │ <- 이미지 번호
└─────────────────────────────────────┘
```

주요 UI 요구사항:
- customtkinter를 통한 다크 테마 지원
- 최근 이미지를 보여주는 스크롤 가능한 썸네일 그리드
- 썸네일 클릭으로 경로 복사
- 상태에 대한 시각적 피드백 (성공/오류 메시지)
- 반응형 레이아웃 (최소 600x400, 기본 800x600)

### 6. 설정 윈도우 (`src/ui/settings_window.py`)

모달 다이얼로그 포함 요소:
- 저장 위치를 위한 디렉토리 선택기
- 최대 이미지 수 슬라이더 (1-100)
- 테마 선택기 (System/Light/Dark)
- 썸네일 크기 슬라이더 (50-200px)
- 저장/취소 버튼

**중요**: 설정 창은 클릭 시 즉시 나타나야 하며, 다음을 사용:
- `window.lift()` 앞으로 가져오기
- `window.attributes('-topmost', True)` 일시적으로
- `window.focus_force()` 즉시 포커스
- 중복 창 방지

## 플랫폼별 고려사항

### macOS
1. **클립보드 접근**: 더 나은 클립보드 처리를 위해 pyobjc가 필요할 수 있음
2. **키 바인딩**: Command 키 지원 필수 (`<Command-v>`)
3. **Tkinter 지원**: Tk 지원으로 빌드된 Python 필요 (tcl-tk와 함께 pyenv 사용)

### Windows
1. **파일 경로**: 백슬래시 올바르게 처리
2. **클립보드**: ImageGrab이 네이티브로 작동
3. **키 바인딩**: Control 키만 사용

### 크로스 플랫폼
- OS 감지를 위해 `platform.system()` 사용
- 플랫폼에 따라 클립보드 작업 추상화
- 다른 플랫폼에서 키 바인딩이 오류를 일으키지 않도록 테스트

## 사용자 경험 흐름

1. **시작**
   - 설정 로드
   - 필요시 저장 디렉토리 생성
   - 그리드에 기존 이미지 표시
   - "준비됨" 상태 표시

2. **붙여넣기 작업**
   - 사용자가 Cmd/Ctrl+V를 누르거나 붙여넣기 버튼 클릭
   - 앱이 클립보드에서 이미지 확인
   - 이미지가 있으면:
     - `saved_images/img_XXXX.png`로 저장
     - 전체 절대 경로를 클립보드에 복사
     - 썸네일 그리드 업데이트
     - 성공 메시지 표시
   - 이미지가 없으면:
     - 빨간색으로 오류 메시지 표시
     - 팝업 다이얼로그 없음

3. **설정 변경**
   - 모달 설정 창 열기
   - 저장 시 즉시 변경 사항 적용
   - 테마 변경 시 UI 업데이트
   - 디렉토리 변경 시 이미지 다시 로드

## 오류 처리

- **클립보드에 이미지 없음**: 일시적인 빨간색 상태 메시지 표시
- **저장 디렉토리 문제**: 자동으로 디렉토리 생성
- **권한 오류**: 세부 정보와 함께 오류 다이얼로그 표시
- **잘못된 설정**: 기본값 사용하고 경고 로그

## 테스트 체크리스트

- [ ] macOS에서 Cmd+V 작동
- [ ] Windows/Linux에서 Ctrl+V 작동
- [ ] 모든 플랫폼에서 붙여넣기 버튼 작동
- [ ] 스크린샷이 올바르게 붙여넣어짐
- [ ] 파일 경로가 절대 경로임
- [ ] 설정이 세션 간 유지됨
- [ ] 테마 변경이 즉시 적용됨
- [ ] 썸네일 그리드가 올바르게 업데이트됨
- [ ] 클릭하여 경로 복사 작동
- [ ] 설정 창이 즉시 나타남
- [ ] 중복 설정 창 없음

## 빌드 및 배포

### 개발 설정
```bash
# 가상 환경 생성
python -m venv venv

# 활성화
source venv/bin/activate  # Mac/Linux
venv\Scripts\activate     # Windows

# 의존성 설치
pip install -r requirements.txt

# 실행
python ImagePathifier.py
```

### requirements 파일
```
Pillow>=10.0.0
pyperclip>=1.8.2
customtkinter>=5.2.0
```

### macOS용 옵션
```
pyobjc-framework-Cocoa  # 더 나은 클립보드 지원
```

## 핵심 구현 참고사항

1. **순차 번호 매기기**: 항상 다음 사용 가능한 번호 찾기, 연속적인 순서 가정하지 않기
2. **클립보드 루프 방지**: 경로 복사 시 붙여넣기 이벤트 트리거하지 않기
3. **UI 반응성**: 적절한 이벤트 처리 사용, 블로킹 작업 피하기
4. **리소스 관리**: max_images 초과 시 오래된 이미지 정리
5. **경로 처리**: 호환성을 위해 항상 절대 경로 사용
6. **상태 피드백**: 빠르고 비침입적인 상태 메시지
7. **설정 검증**: 적용 전 모든 설정 검증

## 성공 기준

애플리케이션이 성공적이려면:
1. 사용자가 단일 키보드 단축키로 이미지를 붙여넣고 경로를 얻을 수 있어야 함
2. Windows와 macOS에서 동일하게 작동해야 함
3. UI가 방해되지 않으면서도 명확한 피드백을 제공해야 함
4. 설정 변경이 즉각적이고 영구적이어야 함
5. 앱이 CLI 워크플로우와 원활하게 통합되어야 함

이 명세서를 통해 누구든지 동일한 기능과 사용자 경험을 가진 ImagePathifier 애플리케이션을 재현할 수 있어야 합니다.